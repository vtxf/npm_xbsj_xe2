/*! For license information please see esueviewer.js.LICENSE.txt */
var XE2;(()=>{"use strict";var e={42227:(e,t,i)=>{i.r(t),i.d(t,{ESUEViewer:()=>r});class s{constructor(e){e=void 0!==e?e:{},this.cfg=void 0!==e.peerConnectionOptions?e.peerConnectionOptions:{},this.cfg.sdpSemantics="unified-plan",this.forceTURN=!1,this.cfg.bundlePolicy="balanced",this.forceMaxBundle=!1,this.pcClient=null,this.dcClient=null,this.tnClient=null,this.sdpConstraints={offerToReceiveAudio:!1,offerToReceiveVideo:1,voiceActivityDetection:!1},this.dataChannelOptions={ordered:!0},this.useMic=!1,this.preferSFU=!1,this.aggregatedStats={};var t=document.createElement("video");if(t.playsInline=!0,t.disablepictureinpicture=!0,t.style.width="100%",t.style.height="100%",t.muted=!0,t.addEventListener("loadedmetadata",(e=>{console.log("loadedmetadata",e)}),!0),t.addEventListener("canplay",(e=>{console.log("oncanplay",e),this.onVideoInitialised&&this.onVideoInitialised()}),!0),"requestVideoFrameCallback"in HTMLVideoElement.prototype){const e=(i,s)=>{if(s.receiveTime&&s.expectedDisplayTime){const e=s.presentationTime-s.receiveTime;this.aggregatedStats.receiveToCompositeMs=e}t.requestVideoFrameCallback(e)};t.requestVideoFrameCallback(e)}this.video=t,this.availableVideoStreams=new Map,this.onWebRtcOffer=null,this.onNewVideoTrack=null,this.onWebRtcCandidate=null,this.onDataChannelConnected=null,this.onDataChannelMessage=null,this.onAggregatedStats=null,this.onVideoInitialised=null,this.latencyTestTimings={TestStartTimeMs:null,UEReceiptTimeMs:null,UEEncodeMs:null,UECaptureToSendMs:null,UETransmissionTimeMs:null,BrowserReceiptTimeMs:null,FrameDisplayDeltaTimeMs:null,Reset:function(){this.TestStartTimeMs=null,this.UEReceiptTimeMs=null,this.UEEncodeMs=null,this.UECaptureToSendMs=null,this.UETransmissionTimeMs=null,this.BrowserReceiptTimeMs=null,this.FrameDisplayDeltaTimeMs=null},SetUETimings:function(e){this.UEReceiptTimeMs=e.ReceiptTimeMs,this.UEEncodeMs=e.EncodeMs,this.UECaptureToSendMs=e.CaptureToSendMs,this.UETransmissionTimeMs=e.TransmissionTimeMs,this.BrowserReceiptTimeMs=Date.now(),this.OnAllLatencyTimingsReady(this)},SetFrameDisplayDeltaTime:function(e){null==this.FrameDisplayDeltaTimeMs&&(this.FrameDisplayDeltaTimeMs=Math.round(e),this.OnAllLatencyTimingsReady(this))},OnAllLatencyTimingsReady:function(e){}}}setVideoEnabled(e){this.video.srcObject.getTracks().forEach((t=>t.enabled=e))}startLatencyTest(e){this.video&&(this.latencyTestTimings.Reset(),this.latencyTestTimings.TestStartTimeMs=Date.now(),e(this.latencyTestTimings.TestStartTimeMs))}handleCandidateFromServer(e){let t=new RTCIceCandidate(e);console.log("%c[Unreal ICE candidate]","background: pink; color: black","| Type=",t.type,"| Protocol=",t.protocol,"| Address=",t.address,"| Port=",t.port,"|"),this.pcClient&&this.pcClient.addIceCandidate(t).catch((function(e){console.error("Failed to add ICE candidate",e)}))}setupPeerConnection(e){e.onsignalingstatechange=function(e){console.info("Signaling state change. |",e.srcElement.signalingState,"|")},e.oniceconnectionstatechange=function(e){console.info("Browser ICE connection |",e.srcElement.iceConnectionState,"|")},e.onicegatheringstatechange=function(e){console.info("Browser ICE gathering |",e.srcElement.iceGatheringState,"|")},e.ontrack=e=>{if(e.track&&console.log("Got track. | Kind="+e.track.kind+" | Id="+e.track.id+" | readyState="+e.track.readyState+" |"),"audio"!=e.track.kind){e.track.kind;for(const t of e.streams)this.availableVideoStreams.has(t.id)||this.availableVideoStreams.set(t.id,t);this.video.srcObject=e.streams[0],e.track.onunmute=()=>{this.video.srcObject=e.streams[0],this.onNewVideoTrack&&this.onNewVideoTrack(e.streams[0])}}},e.onicecandidate=e=>{let t=e.candidate;t&&t.candidate&&(console.log("%c[Browser ICE candidate]","background: violet; color: black","| Type=",t.type,"| Protocol=",t.protocol,"| Address=",t.address,"| Port=",t.port,"|"),this.onWebRtcCandidate&&this.onWebRtcCandidate(t))},e.ondatachannel=e=>{console.log("Data channel created for us by browser as we are a receiving peer."),this.dcClient=e.channel,this.setupDataChannelCallbacks(this.dcClient)}}setupDataChannelCallbacks(e){try{return e.binaryType="arraybuffer",e.onopen=e=>{console.log("Data channel connected"),this.onDataChannelConnected&&this.onDataChannelConnected()},e.onclose=e=>{console.log("Data channel connected",e)},e.onmessage=e=>{this.onDataChannelMessage&&this.onDataChannelMessage(e.data)},e.onerror=e=>{console.error("Data channel error",e)},e}catch(e){return console.warn("No data channel",e),null}}createDataChannel(e,t,i){let s=e.createDataChannel(t,i);return console.log(`Created datachannel (${t})`),this.setupDataChannelCallbacks(s),s}createOffer(){this.pcClient&&(console.log("Closing existing PeerConnection"),this.pcClient.close(),this.pcClient=null),this.pcClient=new RTCPeerConnection(this.cfg),this.setupPeerConnection(this.pcClient),this.setupTransceiversAsync(this.pcClient).finally((()=>{this.dcClient=this.createDataChannel(this.pcClient,"cirrus",this.dataChannelOptions),this.pcClient.createOffer(this.sdpConstraints).then((e=>{e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1;stereo=1;sprop-maxcapturerate=48000"),this.pcClient.setLocalDescription(e),this.onWebRtcOffer&&this.onWebRtcOffer(e)}),(()=>{console.warn("Couldn't create offer")}))}))}setupTransceiversAsync=async function(e){let t=e.getTransceivers().length>0;if(e.addTransceiver("video",{direction:"recvonly"}),this.useMic){let i=!!this.useMic&&{autoGainControl:!1,channelCount:1,echoCancellation:!1,latency:0,noiseSuppression:!1,sampleRate:48e3,volume:1};const s=await navigator.mediaDevices.getUserMedia({video:!1,audio:i});if(s)if(t){for(let t of e.getTransceivers())if(t&&t.receiver&&t.receiver.track&&"audio"===t.receiver.track.kind)for(const e of s.getTracks())e.kind&&"audio"==e.kind&&(t.sender.replaceTrack(e),t.direction="sendrecv")}else for(const t of s.getTracks())t.kind&&"audio"==t.kind&&e.addTransceiver(t,{direction:"sendrecv"});else e.addTransceiver("audio",{direction:"recvonly"})}else e.addTransceiver("audio",{direction:"recvonly"})};receiveOffer(e){var t=new RTCSessionDescription(e);this.pcClient||(console.log("Creating a new PeerConnection in the browser."),this.pcClient=new RTCPeerConnection(this.cfg),this.setupPeerConnection(this.pcClient),this.pcClient.setRemoteDescription(t).then((()=>{this.setupTransceiversAsync(this.pcClient).finally((()=>{this.pcClient.createAnswer().then((e=>this.pcClient.setLocalDescription(e))).then((()=>{this.onWebRtcAnswer&&this.onWebRtcAnswer(this.pcClient.currentLocalDescription)})).then((()=>{let e=this.pcClient.getReceivers();for(let t of e)t.playoutDelayHint=0})).catch((e=>console.error("createAnswer() failed:",e)))}))})))}receiveAnswer(e){var t=new RTCSessionDescription(e);this.pcClient.setRemoteDescription(t);let i=this.pcClient.getReceivers();for(let e of i)e.playoutDelayHint=0}close(){this.pcClient&&(console.log("Closing existing peerClient"),this.pcClient.close(),this.pcClient=null),this.aggregateStatsIntervalId&&clearInterval(this.aggregateStatsIntervalId)}send(e){if(!this.__dataQueue){this.__dataQueue=[];const e=()=>{const t=this.dcClient&&"open"==this.dcClient.readyState;for(;t&&this.__dataQueue.length>0&&this.dcClient.bufferedAmount<=this.dcClient.bufferedAmountLowThreshold;){const e=this.__dataQueue[this.__dataQueue.length-1];this.__dataQueue.pop();try{this.dcClient.send(e)}catch(e){console.error(`dcClient.send error! ${e}`,e)}}requestAnimationFrame(e)};e()}if(!this.__dataQueue)throw new Error("!this.__dataQueue");this.__dataQueue.push(e)}aggregateStats(e){this.aggregatedStats||(this.aggregatedStats={});let t=e=>{let t={};e.forEach((e=>{"inbound-rtp"!=e.type||e.isRemote||"video"!=e.mediaType&&!e.id.toLowerCase().includes("video")||(t.timestamp=e.timestamp,t.bytesReceived=e.bytesReceived,t.framesDecoded=e.framesDecoded,t.packetsLost=e.packetsLost,t.bytesReceivedStart=this.aggregatedStats&&this.aggregatedStats.bytesReceivedStart?this.aggregatedStats.bytesReceivedStart:e.bytesReceived,t.framesDecodedStart=this.aggregatedStats&&this.aggregatedStats.framesDecodedStart?this.aggregatedStats.framesDecodedStart:e.framesDecoded,t.timestampStart=this.aggregatedStats&&this.aggregatedStats.timestampStart?this.aggregatedStats.timestampStart:e.timestamp,this.aggregatedStats&&this.aggregatedStats.timestamp&&(this.aggregatedStats.bytesReceived&&(t.bitrate=8*(t.bytesReceived-this.aggregatedStats.bytesReceived)/(t.timestamp-this.aggregatedStats.timestamp),t.bitrate=Math.floor(t.bitrate),t.lowBitrate=this.aggregatedStats.lowBitrate&&this.aggregatedStats.lowBitrate<t.bitrate?this.aggregatedStats.lowBitrate:t.bitrate,t.highBitrate=this.aggregatedStats.highBitrate&&this.aggregatedStats.highBitrate>t.bitrate?this.aggregatedStats.highBitrate:t.bitrate),this.aggregatedStats.bytesReceivedStart&&(t.avgBitrate=8*(t.bytesReceived-this.aggregatedStats.bytesReceivedStart)/(t.timestamp-this.aggregatedStats.timestampStart),t.avgBitrate=Math.floor(t.avgBitrate)),this.aggregatedStats.framesDecoded&&(t.framerate=(t.framesDecoded-this.aggregatedStats.framesDecoded)/((t.timestamp-this.aggregatedStats.timestamp)/1e3),t.framerate=Math.floor(t.framerate),t.lowFramerate=this.aggregatedStats.lowFramerate&&this.aggregatedStats.lowFramerate<t.framerate?this.aggregatedStats.lowFramerate:t.framerate,t.highFramerate=this.aggregatedStats.highFramerate&&this.aggregatedStats.highFramerate>t.framerate?this.aggregatedStats.highFramerate:t.framerate),this.aggregatedStats.framesDecodedStart&&(t.avgframerate=(t.framesDecoded-this.aggregatedStats.framesDecodedStart)/((t.timestamp-this.aggregatedStats.timestampStart)/1e3),t.avgframerate=Math.floor(t.avgframerate)))),"track"!=e.type||"video_label"!=e.trackIdentifier&&"video"!=e.kind||(t.framesDropped=e.framesDropped,t.framesReceived=e.framesReceived,t.framesDroppedPercentage=e.framesDropped/e.framesReceived*100,t.frameHeight=e.frameHeight,t.frameWidth=e.frameWidth,t.frameHeightStart=this.aggregatedStats&&this.aggregatedStats.frameHeightStart?this.aggregatedStats.frameHeightStart:e.frameHeight,t.frameWidthStart=this.aggregatedStats&&this.aggregatedStats.frameWidthStart?this.aggregatedStats.frameWidthStart:e.frameWidth),"candidate-pair"==e.type&&e.hasOwnProperty("currentRoundTripTime")&&0!=e.currentRoundTripTime&&(t.currentRoundTripTime=e.currentRoundTripTime)})),this.aggregatedStats.receiveToCompositeMs&&(t.receiveToCompositeMs=this.aggregatedStats.receiveToCompositeMs,this.latencyTestTimings.SetFrameDisplayDeltaTime(this.aggregatedStats.receiveToCompositeMs)),this.aggregatedStats=t,this.onAggregatedStats&&this.onAggregatedStats(t)};this.aggregateStatsIntervalId=setInterval((()=>{this.pcClient&&t&&this.pcClient.getStats(null).then((e=>{t(e)}))}),e)}}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}XE2["xe2-base-objects"],window.g_emitDescriptor_maxBytes=3e4,console.log("可以通过以下方式设置信令服务一次传输的最大数据量：window.g_emitDescriptor_maxBytes = 30000");let n=-1;class r extends EventTarget{constructor(e,t){super(),t=t||{},this.domOrDomId=e,this.playerElement=void 0,this.webRtcPlayerObj=null,this.ws=void 0,this.qualityController=!1,this.debug=!1,this.afk={enabled:!1,warnTimeout:120,closeTimeout:10,active:!1,overlay:void 0,warnTimer:void 0,countdown:0,countdownTimer:void 0},this.UIInteractionCallbacks=new Map,this.url=void 0!==t.url?t.url:window.location.href.replace("http://","ws://").replace("https://","wss://"),this.esmsgWsUri=t.esmsgWsUri,this.forceNotUseEsMsgWs=!1,console.log(`forceNotUseEsMsgWs(${this.forceNotUseEsMsgWs})`),console.log("ESUEViewer created: ",this),this.connect()}createWebRtcOffer(){this.webRtcPlayerObj?(console.log("Creating offer"),this.webRtcPlayerObj.createOffer()):console.log("WebRTC player not setup, cannot create offer")}registerKeyboardEvents(){function e(e){return 16===e.keyCode&&"ShiftRight"===e.code?253:17===e.keyCode&&"ControlRight"===e.code?254:18===e.keyCode&&"AltRight"===e.code?255:e.keyCode}document.onkeydown=t=>{18!==t.keyCode&&16!==t.keyCode&&(this.sendInputData(new Uint8Array([60,e(t),t.repeat]).buffer),8===t.keyCode&&document.onkeypress({charCode:8}))},document.onkeyup=t=>{18!==t.keyCode&&16!==t.keyCode&&this.sendInputData(new Uint8Array([61,e(t)]).buffer)},document.onkeypress=e=>{let t=new DataView(new ArrayBuffer(3));t.setUint8(0,62),t.setUint16(1,e.charCode,!0),this.sendInputData(t.buffer)}}sendInputData(e){if(this.esmsgWs&&1===this.esmsgWs.readyState){const t=new Uint8Array(e)[0];if(t>=50&&t<=75){const t=new ArrayBuffer(e.byteLength+4);return new DataView(t).setUint32(0,e.byteLength,!0),new Uint8Array(t,4).set(new Uint8Array(e)),void this.esmsgWs.send(new DataView(t))}}this.webRtcPlayerObj&&(this.resetAfkWarningTimer(),this.webRtcPlayerObj.send(e))}resetAfkWarningTimer(){this.afk.active&&(clearTimeout(this.afk.warnTimer),this.afk.warnTimer=setTimeout((()=>{this.showAfkOverlay()}),1e3*this.afk.warnTimeout))}showAfkOverlay(){}setupStats(){this.webRtcPlayerObj.aggregateStats(1e3)}destroy(){this.ws&&(console.log("ESUEViewer.destroy() ws.close."),this.ws.close()),this.esmsgWs&&(console.log("ESUEViewer.destroy() esmsgWs.close."),this.esmsgWs.close())}connect(){window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket?(this.ws=new WebSocket(this.url),this.ws.onmessage=e=>{let t=JSON.parse(e.data);"config"===t.type?(console.log("%c[Inbound SS (config)]","background: lightblue; color: black",t),this.onConfig(t)):"playerCount"===t.type?console.log("%c[Inbound SS (playerCount)]","background: lightblue; color: black",t):"offer"===t.type?(console.log("%c[Inbound SS (offer)]","background: lightblue; color: black",t),this.webRtcPlayerObj.receiveOffer(t),this.setupStats()):"answer"===t.type?(console.log("%c[Inbound SS (answer)]","background: lightblue; color: black",t),this.webRtcPlayerObj.receiveAnswer(t),this.setupStats()):"iceCandidate"===t.type?this.webRtcPlayerObj&&this.webRtcPlayerObj.handleCandidateFromServer(t.candidate):"warning"===t.type&&t.warning?console.warn(t.warning):console.error("Invalid SS message type",t.type)},this.ws.onerror=e=>{console.log(`WS error: ${JSON.stringify(e)}`),this.dispatchEvent(new CustomEvent("wserror",{detail:e}))},this.ws.onclose=e=>{console.log(`WS closed: ${JSON.stringify(e.code)} - ${e.reason}`),this.ws=void 0,this.webRtcPlayerObj&&(this.webRtcPlayerObj.close(),this.webRtcPlayerObj.video&&this.playerElement.removeChild(this.webRtcPlayerObj.video),this.webRtcPlayerObj=void 0),this.dispatchEvent(new CustomEvent("wsclose",{detail:e}))},this.esmsgWsUri&&(this.esmsgWs=new WebSocket(this.esmsgWsUri),this.esmsgWs.onopen=()=>{console.warn("earthsdk message websocket server connected:",this.esmsgWsUri)},this.esmsgWs.onmessage=e=>{let t,i=new FileReader;var s=this;i.onload=function(e){t=e.target.result;let i=new Uint32Array(t),a=0;if(1===i[0]){a+=4;let e=i[a/4];a+=4;for(let n=0;n<e;n++){let e=i[a/4];a+=4;let n=new TextDecoder("utf-8").decode(t.slice(a,a+e));a+=e,s.processResponse(n)}}},i.readAsArrayBuffer(e.data)})):alert("Your browser doesn't support WebSocket")}onConfig(e){this.playerElement="string"==typeof this.domOrDomId?document.getElementById(this.domOrDomId):this.domOrDomId,this.setupWebRtcPlayer(this.playerElement,e)}emitUIInteraction(e,t){"function"==typeof t&&(e.callid=a(),this.UIInteractionCallbacks.set(e.callid,t)),this.emitDescriptor(50,e)}emitUIInteractionForBigData(e,t){"function"==typeof t&&(e.callid=a(),this.UIInteractionCallbacks.set(e.callid,t)),this.emitDescriptorForBigData(50,e)}resizeUEVideo(e,t){let i={Resolution:{Width:e,Height:t}};console.log(`resizeUEVideo emitCommand ${e} ${t} begin`),this.emitCommand(i),console.log(`resizeUEVideo emitCommand ${e} ${t} end`)}emitCommand(e){this.emitDescriptor(51,e)}requestInitialSettings(){this.sendInputData(new Uint8Array([7]).buffer)}requestQualityControl(){this.qualityController||this.sendInputData(new Uint8Array([1]).buffer)}playVideoStream(){this.webRtcPlayerObj&&this.webRtcPlayerObj.video&&(this.webRtcPlayerObj.video.play().catch((function(e){console.error(e),console.log("Browser does not support autoplaying video without interaction - to resolve this we are going to show the play button overlay.")})),this.requestInitialSettings(),this.requestQualityControl())}emitDescriptor(e,t){let i=JSON.stringify(t),s=new DataView(new ArrayBuffer(3+2*i.length)),a=0;s.setUint8(a,e),a++,s.setUint16(a,i.length,!0),a+=2;for(let e=0;e<i.length;e++)s.setUint16(a,i.charCodeAt(e),!0),a+=2;this.sendInputData(s.buffer)}_emitDescriptorWithString(e,t){let i=new DataView(new ArrayBuffer(3+2*t.length)),s=0;i.setUint8(s,e),s++,i.setUint16(s,t.length,!0),s+=2;for(let e=0;e<t.length;e++)i.setUint16(s,t.charCodeAt(e),!0),s+=2;try{this.sendInputData(i.buffer)}catch(e){console.error(`data.buffer.size: ${i.buffer.byteLength} sendInputData error: ${e}`,e)}}_emitDescriptorWithString2(e,t){let i=(new TextEncoder).encode(t),s=new DataView(new ArrayBuffer(3+i.length)),a=0;s.setUint8(a,e),a++,s.setUint16(a,i.length,!0),a+=2;for(let e=0;e<i.length;e++)s.setUint8(a,i[e]),a+=1;try{this.sendInputData(s.buffer)}catch(e){console.error(`data.buffer.size: ${s.buffer.byteLength} 独立通道 sendInputData error: ${e}`,e)}}emitDescriptorForBigData(e,t){if(50!==e)return void console.error("messageType !== MessageType.UIInteraction emitDescriptorForBigData只能处理MessageType.UIInteraction类型消息！");const i=JSON.stringify(t),s=window.g_emitDescriptor_maxBytes,a=i.length,r=++n;if(this.esmsgWs&&1===this.esmsgWs.readyState)return void this._emitDescriptorWithString2(e,`${r}-0/1-`+i);if(a<s)return void this._emitDescriptorWithString(e,`${r}-0/1-`+i);const o=0|Math.ceil(a/s);[...new Array(o).keys()].map((e=>i.slice(e*s,(e+1)*s))).forEach(((t,i)=>this._emitDescriptorWithString(e,`${r}-${i}/${o}-`+t)))}setupWebRtcPlayer(e,t){if(e)return this.webRtcPlayerObj=new s(t),e.appendChild(this.webRtcPlayerObj.video),this.webRtcPlayerObj.onWebRtcOffer=e=>{if(this.ws&&1===this.ws.readyState){let t=JSON.stringify(e);console.log("%c[Outbound SS message (offer)]","background: lightgreen; color: black",e),this.ws.send(t)}},this.webRtcPlayerObj.onWebRtcCandidate=e=>{this.ws&&1===this.ws.readyState&&this.ws.send(JSON.stringify({type:"iceCandidate",candidate:e}))},this.webRtcPlayerObj.onWebRtcAnswer=e=>{if(this.ws&&1===this.ws.readyState){let t=JSON.stringify(e);console.log("%c[Outbound SS message (answer)]","background: lightgreen; color: black",e),this.ws.send(t)}},this.webRtcPlayerObj.onVideoInitialised=()=>{this.ws&&1===this.ws.readyState?(this.setupNormalizeAndQuantize(this.playerElement),this.registerHoveringMouseEvents(this.playerElement),this.registerMouseEnterAndLeaveEvents(this.playerElement),this.playVideoStream(),this.registerKeyboardEvents(),this.dispatchEvent(new CustomEvent("videoinited",{detail:this.getVideoSize()}))):console.log("onVideoInitialised")},this.webRtcPlayerObj.onDataChannelConnected=()=>{this.ws&&1===this.ws.readyState&&this.requestQualityControl()},this.webRtcPlayerObj.onNewVideoTrack=e=>{},this.webRtcPlayerObj.onDataChannelMessage=e=>{let t=new Uint8Array(e);if(0===t[0]){let e=0!==t[1];console.log("Received quality controller message, will control quality: "+e),this.qualityController=e}else if(1===t[0]){let t=new TextDecoder("utf-16").decode(e.slice(1));this.processResponse(t)}else if(2===t[0]){let t=new TextDecoder("utf-16").decode(e.slice(1));console.log(t)}else if(3===t[0]);else if(4===t[0]);else if(5===t[0])new TextDecoder("utf-16").decode(e.slice(1));else if(6==t[0]){let t=new TextDecoder("utf-16").decode(e.slice(1));console.log("Got latency timings from UE."),console.log(t);let i=JSON.parse(t);this.webRtcPlayerObj&&this.webRtcPlayerObj.latencyTestTimings.SetUETimings(i)}else if(7==t[0]){let t=new TextDecoder("utf-16").decode(e.slice(1)),i=JSON.parse(t);console.log("ToClientMessageType.InitialSettings",i)}else 8==t[0]||9==t[0]||10==t[0]||console.error(`unrecognized data received, packet ID ${t[0]}`)},this.createWebRtcOffer(),this.webRtcPlayerObj.video}resolveCallback(e){let t={};try{t=JSON.parse(e)}catch(e){return!1}let i=t.callid;if("string"!=typeof i)return!1;if(!this.UIInteractionCallbacks.has(i))return!1;let s=this.UIInteractionCallbacks.get(i);return"function"==typeof s&&(s(t),this.UIInteractionCallbacks.delete(i),!0)}processResponse(e){if(this.debug)try{const t=JSON.parse(e);if(t.ers=t.ers&&t.ers.filter((e=>"mouseMoveEvent"!==e.et)),!(t.ers&&t.ers.length>0||t.frs&&t.frs.length>0))return;console.log("-----------------------------------------------------------"),console.log("--------------------- ue -> begin ---------------------"),console.log(JSON.stringify(t,void 0,"    ")),console.log("--------------------- ue -> end   ---------------------"),console.log("-----------------------------------------------------------")}catch(t){console.error(`processResponse(${e}) error: ${t}`,t)}this.resolveCallback(e)||this.dispatchEvent(new CustomEvent("ueevent",{detail:e}))}emitMouseMove(e,t,i,s){let a=this.normalizeAndQuantizeUnsigned(e,t),n=this.normalizeAndQuantizeSigned(i,s),r=new DataView(new ArrayBuffer(9));r.setUint8(0,74),r.setUint16(1,a.x,!0),r.setUint16(3,a.y,!0),r.setInt16(5,n.x,!0),r.setInt16(7,n.y,!0),this.sendInputData(r.buffer)}emitMouseDown(e,t,i){let s=this.normalizeAndQuantizeUnsigned(t,i),a=new DataView(new ArrayBuffer(6));a.setUint8(0,72),a.setUint8(1,e),a.setUint16(2,s.x,!0),a.setUint16(4,s.y,!0),this.sendInputData(a.buffer,!0)}emitMouseUp(e,t,i){let s=this.normalizeAndQuantizeUnsigned(t,i),a=new DataView(new ArrayBuffer(6));a.setUint8(0,73),a.setUint8(1,e),a.setUint16(2,s.x,!0),a.setUint16(4,s.y,!0),this.sendInputData(a.buffer)}emitMouseWheel(e,t,i){let s=this.normalizeAndQuantizeUnsigned(t,i),a=new DataView(new ArrayBuffer(7));a.setUint8(0,75),a.setInt16(1,e,!0),a.setUint16(3,s.x,!0),a.setUint16(5,s.y,!0),this.sendInputData(a.buffer)}releaseMouseButtons(e,t,i){1&e&&this.emitMouseUp(0,t,i),2&e&&this.emitMouseUp(2,t,i),4&e&&this.emitMouseUp(1,t,i),8&e&&this.emitMouseUp(3,t,i),16&e&&this.emitMouseUp(4,t,i)}pressMouseButtons(e,t,i){1&e&&this.emitMouseDown(0,t,i),2&e&&this.emitMouseDown(2,t,i),4&e&&this.emitMouseDown(1,t,i),8&e&&this.emitMouseDown(3,t,i),16&e&&this.emitMouseDown(4,t,i)}registerHoveringMouseEvents(e){e.onmousemove=e=>{this.emitMouseMove(e.offsetX,e.offsetY,e.movementX,e.movementY),e.preventDefault()},e.onmousedown=e=>{this.emitMouseDown(e.button,e.offsetX,e.offsetY),e.preventDefault()},e.onmouseup=e=>{this.emitMouseUp(e.button,e.offsetX,e.offsetY),e.preventDefault()},e.oncontextmenu=e=>{this.emitMouseUp(e.button,e.offsetX,e.offsetY),e.preventDefault()},"onmousewheel"in e?e.onmousewheel=e=>{this.emitMouseWheel(e.wheelDelta,e.offsetX,e.offsetY),e.preventDefault()}:e.addEventListener("DOMMouseScroll",(e=>{this.emitMouseWheel(-120*e.detail,e.offsetX,e.offsetY),e.preventDefault()}),!1),e.pressMouseButtons=e=>{this.pressMouseButtons(e.buttons,e.offsetX,e.offsetY)},e.releaseMouseButtons=e=>{this.releaseMouseButtons(e.buttons,e.offsetX,e.offsetY)}}getVideoSize(){if(!this.playerElement)return;let e=this.playerElement.getElementsByTagName("video");return e.length<=0?void 0:{width:e[0].videoWidth,height:e[0].videoHeight}}resize(e,t){this.playerElement&&(this.playerElement.style.width=e+"px",this.playerElement.style.height=t+"px",this.setupNormalizeAndQuantize(this.playerElement))}resizePlayerStyleToActualSize(e){if(!e)return;let t=e.getElementsByTagName("video");t.length>0&&(e.style.width=t[0].videoWidth+"px",e.style.height=t[0].videoHeight+"px")}registerMouseEnterAndLeaveEvents(e){e.onmouseenter=t=>{let i=new DataView(new ArrayBuffer(1));i.setUint8(0,70),this.sendInputData(i.buffer),e.pressMouseButtons(t)},e.onmouseleave=t=>{let i=new DataView(new ArrayBuffer(1));i.setUint8(0,71),this.sendInputData(i.buffer),e.releaseMouseButtons(t)}}setupNormalizeAndQuantize(e){let t=e.getElementsByTagName("video");if(e&&t.length>0){let i=e.clientHeight/e.clientWidth,s=t[0].videoHeight/t[0].videoWidth;if(i>s){let t=i/s;this.normalizeAndQuantizeUnsigned=(i,s)=>{let a=i/e.clientWidth,n=t*(s/e.clientHeight-.5)+.5;return a<0||a>1||n<0||n>1?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*a,y:65536*n}},this.unquantizeAndDenormalizeUnsigned=(i,s)=>{let a=(s/65536-.5)/t+.5;return{x:i/65536*e.clientWidth,y:a*e.clientHeight}},this.normalizeAndQuantizeSigned=(i,s)=>({x:i/(.5*e.clientWidth)*32767,y:t*s/(.5*e.clientHeight)*32767})}else{let t=s/i;this.normalizeAndQuantizeUnsigned=(i,s)=>{let a=t*(i/e.clientWidth-.5)+.5,n=s/e.clientHeight;return a<0||a>1||n<0||n>1?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*a,y:65536*n}},this.unquantizeAndDenormalizeUnsigned=(i,s)=>{let a=s/65536;return{x:((i/65536-.5)/t+.5)*e.clientWidth,y:a*e.clientHeight}},this.normalizeAndQuantizeSigned=(i,s)=>({x:t*i/(.5*e.clientWidth)*32767,y:s/(.5*e.clientHeight)*32767})}}}}window.ESUEViewer=r}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.ESUEViewer=void 0;var t=i(42227);Object.defineProperty(e,"ESUEViewer",{enumerable:!0,get:function(){return t.ESUEViewer}})})(),(XE2=void 0===XE2?{}:XE2).esueviewer=s})();